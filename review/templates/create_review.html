{% extends 'base.html' %}

{% block content %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ edit_mode ? "Edit Review" : "Create Review" }}</title>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.2/css/all.min.css">
</head>
<body>
    <h1>{{ edit_mode ? "Edit Review for " : "Create a Review for " }}{{ book_title }}</h1>

    <a href="{% url 'review:show_reviews' book_id=book_id %}">Back to Book Details</a>

    <form id="review-form">
        {% csrf_token %}
        <label for="stars_rating">Rating:</label>
        <select name="stars_rating" required>
            <option value="0">0</option>
            <option value="0.5">0.5</option>
            <option value="1">1</option>
            <option value="1.5">1.5</option>
            <option value="2">2</option>
            <option value="2.5">2.5</option>
            <option value="3">3</option>
            <option value="3.5">3.5</option>
            <option value="4">4</option>
            <option value="4.5">4.5</option>
            <option value="5">5</option>
        </select>
        
        <label for="status_on_review">Status on Review:</label>
        <select name="status_on_review" required>
            <!-- Isi ini dengan data yang akan diambil melalui AJAX -->
        </select>
        
        <label for="review_text">Review Text:</label>
        <textarea name="review_text" rows="4" cols="50" required>{{ review.review_text }}</textarea>
        
        <button type="submit">{{ edit_mode ? "Edit Review" : "Submit Review" }}</button>
    </form>

    <!-- Container untuk menampilkan gambar bintang -->
    <div id="star-container">
        <i class="fas fa-star"></i>
        <i class="fas fa-star"></i>
        <i class="fas fa-star"></i>
        <i class="fas fa-star"></i>
        <i class="fas fa-star"></i>
    </div>

    <script>
        $(document).ready(function() {
            var editMode = "{{ edit_mode|lower }}";
            
            // Ketika pilihan rating berubah
            $("select[name='stars_rating']").change(function() {
                var selectedRating = parseFloat($(this).val);
                var starContainer = $("#star-container");

                // Menghapus bintang sebelumnya
                starContainer.empty();

                // Menambahkan bintang sesuai dengan rating yang dipilih oleh pengguna
                for (var i = 1; i <= 5; i++) {
                    if (i <= selectedRating) {
                        // Menampilkan bintang penuh
                        starContainer.append('<i class="fas fa-star"></i>');
                    } else if (i - 0.5 <= selectedRating) {
                        // Menampilkan bintang setengah
                        starContainer.append('<i class="fas fa-star-half-alt"></i>');
                    } else {
                        // Menampilkan bintang kosong
                        starContainer.append('<i class="far fa-star"></i>');
                    }
                }
            });

            // Ambil data status_on_review melalui AJAX
            if (!editMode) {
                $.ajax({
                    url: "{% url 'review:create_review_ajax' book_id=book_id %}",
                    method: 'GET',
                    success: function(response) {
                        var statusOnReview = response.status_on_review;

                        // Isi pilihan dropdown dengan statusOnReview yang diambil
                        $("select[name='status_on_review']").val(statusOnReview);
                    },
                    error: function(error) {
                        console.error("Terjadi kesalahan saat mengambil data status_on_review.");
                    }
                });
            }

            // Star rating
            $("#star-rating").rating({
                'size': 'xs',
                'showClear': false,
                'showCaption': false,
                'step': 0.5
            });
        });
    </script>
</body>
</html>

{% endblock %}
